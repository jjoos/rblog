#!/usr/bin/env bash

set -x
set -e

function echoStep {
  printf $'\e[37;44m\033[1m'"$1"
  echo $'\033[0m'
}

if [[ ! -d ./tmp/postgres ]]; then
  echoStep "Creating a data folder for postgres"
  initdb './tmp/postgres' -E utf8 --locale en_US

  echoStep "Starting postgres"

  postgres -D 'tmp/postgres' -k . -p 3910 -h localhost &
  POSTGRES_PID=$!
  sleep 2

  echoStep "Creating database"
  createdb -p 3910 -h localhost rblog_development

  pwd

  npm run setup_database

  echoStep "Killed postgres and waiting two seconds for postgresql shutdown."
  kill $POSTGRES_PID
fi
