#!/usr/bin/env bash

function echoStep {
  printf $'\e[37;44m\033[1m'"$1"
  echo $'\033[0m'
}

echoStep "Starting postgres."

if [[ ! -d ./tmp/postgres ]]; then
  echoStep "Creating a data folder for postgres."
  initdb './tmp/postgres' -E utf8 --locale en_US

  echoStep "Starting postgres."

  postgres -D 'tmp/postgres' -k . -p 3910 -h localhost &
  POSTGRES_PID=$!

  echoStep "Dropping database"
  dropdb -p 3910 -h localhost rblog_development

  echoStep "Creating database"
  createdb -p 3910 -h localhost rblog_development

  ./bin/create_schema

  echoStep "Killed postgres and waiting two seconds for postgresql shutdown."
  kill $POSTGRES_PID
fi
